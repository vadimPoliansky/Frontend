@model IndInv.Models.ViewModels.indexViewModel
@{
    ViewBag.Title = "Search Results";
    ViewBag.fiscalYear = Model.Fiscal_Year;
}
<div id="pushList">
    <input class="search" id="search_input" name="Search" type="search" placeholder="Search" />
    <span class="filterExpand"><i class="fa fa-filter fa-2x"></i></span>

    <div class="inner-wrap">

        <ul id="myTags" class="tagList">
        </ul>

        <ul class="list" style="list-style: none">
            @foreach (var item in Model.allIndicators.OrderBy(x => x.Indicator))
            {
                var coeID = item.Indicator_CoE_Map.Count > 0 ? item.Indicator_CoE_Map.FirstOrDefault().CoE_ID : 0;
                var areaID = (int?)item.Area_ID ?? 0;
                <div class="block" coeID="@coeID" areaID="@item.Area_ID" filtered="false">
                    <li>
                        <div class="row collapse blockContent">
                            <div class="small-3 columns" style="font-size: small">
                                <strong class="coe">@Html.DisplayTextFor(modelItem => item.Indicator_CoE_Map.FirstOrDefault().CoE.CoE_Abbr).ToString().Trim()</strong>
                                <br />
                                <em class="area">@Html.DisplayTextFor(modelIem => item.Area.Area).ToString().Trim()</em>
                            </div>
                            <div class="small-8 columns titleColumn">
                                <span class="title" style="font-size: small">@Html.DisplayTextFor(modelItem => item.Indicator).ToString().Trim()</span>
                            </div>
                        </div>
                    </li>
                </div>
            }
        </ul>
    </div>

</div>

<div id="menuFilter">
    <nav>
        <h2 class="backBtnMain"><i class="fa fa-times backBtnMain"></i>Filter by:</h2>
        <ul>
            <li>
                <a href="#"><i class="fa fa-filter"></i>CoE</a>
                <h2 class="backBtn"><i class="fa fa-times backBtn"></i>Filter by CoE:</h2>
                <ul class="doubleList">
                    @foreach (var coe in Model.allCoEs)
                    {
                        <li>
                            <small><a href="#" class="filterCoEID" id="@coe.CoE_ID" coe="@coe.CoE">@coe.CoE_Abbr</a></small>
                        </li>
                    }
                </ul>
            </li>
        </ul>
    </nav>
</div>

<div class="overlay"></div>

<script type="text/javascript" src="../../Scripts/jquery-1.11.0.min.js" ></script>
<script type="text/javascript" src="/../../Scripts/jquery-ui-1.8.20.min.js" ></script>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css">

<link rel="stylesheet" href="../../Scripts/jquery.multilevelpushmenu.css" />
<script type="text/javascript" src="../../Scripts/jquery.multilevelpushmenu.js" ></script>

<script type="text/javascript" src="~/Scripts/jquery.simplemodal.1.4.4.min.js"></script>

<script type="text/javascript" src="~/Scripts/jquery.fastLiveFilter.js"></script>
<script type="text/javascript" src="../../Scripts/foundation.min.js" ></script>
<script type="text/javascript" src="../../Scripts/rem.min.js" ></script>
<script type="text/javascript" src="/../../Scripts/tag-it.min.js" ></script>
<script type="text/javascript" src="/../../Scripts/list.min.js" ></script>
<script type="text/javascript" src="/../../Scripts/list.fuzzysearch.min.js" ></script>

<script type="text/javascript">
    $(document).ready(function ($) {

        $(".overlay").hide()

        $(".block").on("click", function () {
            //$.get("Indicator/editInventory?indicatorID=1001&fiscalYear=1", function (result) {
            //});
            var src = "Indicator/details?indicatorID=1001&fiscalYear=1";
            $.modal('<iframe src="' + src + '" height="450" width="830" style="border:0">', {
                closeHTML: "",
                containerCss: {
                    backgroundColor: "#fff",
                    borderColor: "#fff",
                    height: $(window).height(),
                    padding: 0,
                    width: $(window).width(),
                },
                overlayClose: true
            });
        });

        $('#menuFilter').multilevelpushmenu({
            fullCollapse: true,
            collapsed: true,
            menuWidth: '80%',
            onExpandMenuStart: function () {
                $(".overlay").fadeIn("fast");
            },
            onCollapseMenuStart: function () {
                if($('#menuFilter').multilevelpushmenu('activemenu').attr('data-level') == 0 ){
                    $(".overlay").fadeOut("fast");
                }
            },
            backItemIcon: 'fa fa-times',
        });

        $('.backItemClass').remove();

        $('.backBtn').on('click', function () {
            $('#menuFilter').multilevelpushmenu('collapse', 0)
        });

        $('.backBtnMain').on('click', function () {
            $('#menuFilter').multilevelpushmenu('collapse')
            $(".overlay").fadeOut("fast");
        });

        $('.filterExpand').click(function () {
            $('#menuFilter').multilevelpushmenu('expand');
        });

        $('#menuFilter').multilevelpushmenu('redraw');

        var hidden = false;

        $('#search_input').on('keyup change search', function () {
            var valThis = $(this).val().toLowerCase();
            if (valThis == "") {
                $('.block > li > .row > .titleColumn > .title[filtered="false"]').closest(".block").show()
            } else {
                $('.block > li > .row > .titleColumn > .title').each(function () {
                    if ($(this).closest(".block").attr('filtered') == "false") {
                        var text = $(this).text().toLowerCase();
                        var listItems;
                        if (text.indexOf(valThis) >= 0) {
                            //$(this).closest(".block").show()
                            $(this).closest(".block").attr('textFiltered', false);
                        } else {
                            //$(this).closest(".block").hide();
                            $(this).closest(".block").attr('textFiltered', true);
                        }
                    }
                });
            };
            refreshView();
        });


        $("#myTags").tagit({
            onTagClicked: function (event, ui) {
                $("#myTags").tagit("removeTagByLabel", ui.tagLabel);
            },
            beforeTagRemoved: function (event, ui) {
                var field = ui.tag.attr('field');
                var id = ui.tag.attr('id');
                updateFilterHide(id, field);
                $('.filter' + field + "[id='" + id + "']").closest('li').removeClass('filterCheck');
                //$('.filter' + field + "[id='" + id + "']").removeClass('filterCheck');
            },
            afterTagRemoved: function (event, ui) {
                if ($("#myTags").tagit("assignedTags").length === 0) {
                    $('.block').attr("filtered", false);
                    refreshView();
                }
            },
        });

        $(".filterCoEID").on("click", function () {
            var coe = $(this).attr('coe');
            var coeID = $(this).attr('id');
            var tags = $("#myTags").tagit("assignedTags");
            if ($.inArray(coe, tags) === -1) {
                $(this).closest('li').addClass('filterCheck');
                //$(this).addClass('filterCheck');
                $("#myTags").tagit("createTag", coe);
                $('ul li:nth-last-child(2)').attr('id', coeID);
                $('ul li:nth-last-child(2)').attr('field', 'coeID');
                updateFilter(coeID, "coeID");
            } else {
                $(this).parent().parent().removeClass('filterCheck');
                $(this).removeClass('filterCheck');
                $("#myTags").tagit("removeTagByLabel", coe);
                updateFilterHide(coeID, "coeID");
            }
            refreshView();
        });

        function updateFilter(id, field) {
            //if (!hidden) {
            //    $('.block').hide();
            //    hidden = true;
            //}
            $('.block').attr("filtered", true);
            //$('.list div[' + field + "=" + id + ']').show();
            $('.list div[' + field + "=" + id + ']').attr("filtered", false);
        }
        function updateFilterHide(id, field) {
            //$('.list div[' + field + "=" + id + ']').hide();
            $('.block').attr("filtered", false);
            $('.list div[' + field + "=" + id + ']').attr("filtered", true);
        }

        function refreshView() {
            console.log("asdf");
            $('.block').show();
            $('.block[filtered="true"]').hide();
            $('.block[textFiltered="true"]').hide();
        }
    });
</script>

<style>

    .left-off-canvas-menu {
        height: 100%;
    }

    .list {
        margin:0px;
    }

    .block {
        background-color:none !important;
        border-top: 1px solid lightgray;
        padding-bottom: 5%;
    }
        .block:hover {
            background-color:lightblue !important;
        }

    .blockContent {
        padding:5px;
    }

    #myTags {
        width:100%;
    }

    .tagit-choice {
        background-color:#c8ffc2;
        padding:15px;
        width:100%;
        border-bottom:1px solid lightgray;
    }
    .tagit-label {
        color:black;
        font-weight:bold;
    }
    .text-icon {
        float:right;
        position:relative;
        top:-10px;
        font-size:xx-large;
    }

    .doubleList {
        -moz-column-count: 2;
        -moz-column-gap: 0px;
        -webkit-column-count: 2;
        -webkit-column-gap: 0px;
        column-count: 2;
        column-gap: 0px;
    }
    .tagList {
        -moz-column-count: 1;
        -moz-column-gap: 0px;
        -webkit-column-count: 1;
        -webkit-column-gap: 0px;
        column-count: 1;
        column-gap: 0px;
        list-style-type: none;
        padding:0; margin:0;
    }

    .search {
        float:left;
        background-image: url(http://www.levenmetwater.nl/static/global/images/icon-search.png);
        background-position: 10px center;
        background-repeat: no-repeat;
        margin: 0px !important;
        width: 100%;
        height: 40px;
        padding: 10px 45px 10px 10px !important;
        text-indent: 20px;
        -webkit-transition: all 0.2s;
        -moz-transition: all 2s;
        transition: all 0.2s;
        border:none;
    }
        .search:focus {
            background-position: -20px center;
            text-indent: 20px;
        }

        .search::-webkit-search-cancel-button{
            position:relative;
            right:25px;
  
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius:0px;
        }
            .search::-webkit-search-cancel-button::before {
                font-family: FontAwesome;
                font-size:large;
                content: "\f057";
                color:black;

            }

    .filterExpand {
        color:white;
        position:relative;
        top:-37px;
        padding: 5px 0 0px 15px;
        float: right;
        width: 50px;
        margin: 0px !important;
        font-size: small;
        height: 37px !important;
        overflow: hidden !important;
        vertical-align: middle;
        background-color: #0094ff;
    }


    #menuFilter .multilevelpushmenu_wrapper h2 {
	font-size: medium !important;
	line-height: 1em;
	font-weight: lighter;
    margin-top:0;
	color: white;
    height:50px;
	padding: 1em .4em .4em .4em;
    background-color: #0094ff;
    font-family: Optima, Segoe, "Segoe UI", Candara, Calibri, Arial, sans-serif;
}

    #menuFilter .levelHolderClass {
        background-color:white !important;
        color:white;
    }

    #menuFilter li:hover {
        background-color:#54c5ff !important;
        border:0 !important;
    }

    #menuFilter li {
        border:0;
        padding:0;
    }

    #menuFilter .multilevelpushmenu_wrapper a {
        color:#0094ff !important;
        border:0 !important;
        padding:9px;
    }

    .backItemClass {
        background-color:white !important;
        color:#0094ff !important;
        border:0px !important;
    }
        .backItemClass a {
            font-size: medium !important;
        }
        .backItemClass:hover {
            background-color:#54c5ff !important;
        }

     #menuFilter .filterCheck::before {
        float:right;
        font-family: FontAwesome;
        font-size:large;
        content: "\f00c";
        color:white;
        padding-right:5px;
    }

    #menuFilter .filterCheck {
        background-color:#4cff00 !important;
        color:white !important; 
    }

    #menuFilter .filterCheck:hover {
        background-color:#a3ff7c !important;
    }

    .ui-autocomplete-input {
        visibility:hidden !important;
    }

    .inner-wrap {
        position:absolute;
        top:37px;
    }

</style>
